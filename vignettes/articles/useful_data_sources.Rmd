---
title: "Useful data sources"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(popim)
library(dplyr)
```
When using the the `popim` package it can be useful to initialise
populations and vaccination activities with realistic data.

## Population data

The age strucutred population size through time is a heavy data
requirement, but the 
[UN World Population Prospects](https://population.un.org/wpp/) has
population data in the right format for use with popim.

There is an API that can be accessed programmatically from R, but I
haven't managed to get this to work yet.

However, country-based population size by single-year age group can be
downloaded in .csv file format at
https://population.un.org/wpp/Download/Standard/CSV/ . The most
relevant files are:

WPP2024_PopulationBySingleAgeSex_Medium_1950-2023.zip
WPP2024_PopulationBySingleAgeSex_Medium_2024-2100.zip

```{r}

pop <- read.csv("inst/extdata/hide/WPP2024_Population1JanuaryBySingleAgeSex_Medium_1950-2023.csv",
                stringsAsFactors = FALSE, na.strings = "<NA>",
                encoding = "UTF-8")
pop2 <- read.csv("inst/extdata/hide/WPP2024_Population1JanuaryBySingleAgeSex_Medium_2024-2100.csv",
                 stringsAsFactors = FALSE, na.strings = "<NA>",
                 encoding = "UTF-8")

## extracting some meta-information on geographical regions available:
regions <- pop |> select(ISO3_code:Location) |> unique()

## What types of regions are there?
LocationTypes <- regions |> group_by(LocTypeID, LocTypeName) |> count()

geo_regions <- regions |> filter(LocTypeID == 2) |>
    select(SDMX_code, LocTypeID, LocTypeName, Location)

dev_group <- regions |> filter(LocTypeID == 5) |>
    select(SDMX_code, LocTypeID, LocTypeName, Location)

SDG_region <- regions |> filter(LocTypeID == 12) |>
    select(SDMX_code, LocTypeID, LocTypeName, Location)

Income_group <- regions |> filter(LocTypeID == 13) |>
    select(SDMX_code, LocTypeID, LocTypeName, Location)

## What countries are available?
countries <- regions |> filter(LocTypeID == 4) |>
    select(ISO3_code, ISO2_code, SDMX_code, Location) |>
    arrange(SDMX_code)





## setting up a popim_population from the UNWPP data:
my_countries <- c("India", "Nigeria") ## selecting by `Location`

drop_unwpp_cols <- function(dat, countries) {
    dat |> filter(Location %in% countries) |>
    select(Location, Time, AgeGrpStart, PopTotal) |>
    rename(region = Location, year = Time, age = AgeGrpStart,
           pop_size = PopTotal)
}

pop <- drop_unwpp_cols(pop, my_countries)
pop2 <- drop_unwpp_cols(pop2, my_countries)

pop <- rbind(pop, pop2)
rm(pop2)

pop <- as_popim_pop(pop)

plot_pop_size(pop)
plot_pop_size(pop, rel = TRUE) ## relative population size, to
                               ## highlight the age structure


```
## Vaccination data
