<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>popim â€¢ popim</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="popim">
<meta property="og:description" content="popim">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">popim</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/popim.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>popim</h1>
            
      
      
      <div class="hidden name"><code>popim.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">popim</span><span class="op">)</span></span></code></pre></div>
<p>The intention of the package <code>popim</code> is to provide tools
to easily evaluate and track the POPulation IMmunity of an
age-structured population that results from vaccination. Given that
vaccination has long lasting effects, this requires tracking the status
of the population through time.</p>
<div class="section level2">
<h2 id="data-structures">Data structures<a class="anchor" aria-label="anchor" href="#data-structures"></a>
</h2>
<p>To this end the package defines two S3 classes to store data in an
appropriate format. Both classes are dataframes, but have additional
requirements such as certain columns that must be present, and the
format and range of these columns.</p>
<div class="section level3">
<h3 id="s3-class-popim_population">S3 class <code>popim_population</code><a class="anchor" aria-label="anchor" href="#s3-class-popim_population"></a>
</h3>
<p>The class <code>popim_population</code> is designed to hold
information on a population of interest.</p>
<div class="section level4">
<h4 id="the-dataframe">The dataframe<a class="anchor" aria-label="anchor" href="#the-dataframe"></a>
</h4>
<p>The dataframe holds information on the population size and immunity
status of the population through time. The population is disaggregated
into 1-year age groups, and potentially several spatial regions. Each
row refers to a particular (1 year) birth cohort in a given location and
year.</p>
<p>The mandatory columns are:</p>
<ul>
<li>
<code>region</code>: The population of interest may be spatially
disaggregated into separate geographical regions (e.g., countries or
subnational administrative regions). This column holds a string that
identifies which region each entry refers to.</li>
<li>
<code>year</code>: The population is tracked through time using
annual time steps.</li>
<li>
<code>age</code>: The age-structure of the population is tracked in
annual age groups.</li>
<li>
<code>cohort</code>: This column is redundant as it equals
<code>year</code> - <code>age</code>, and therefore refers to the year
in which this cohort was born. It is included for ease of handling.</li>
<li>
<code>immunity</code>: Gives the proportion of each cohort that is
immune due to past vaccination.</li>
<li>
<code>pop_size</code>: Number of people in any given age group and
year. To facilitate using common units such as thousands this is not
limited to integer values. It is however up to the user to ensure that
such units are used consistently.</li>
</ul>
<table class="table">
<thead><tr class="header">
<th>column</th>
<th>type</th>
<th>range</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>region</code></td>
<td>character</td>
<td></td>
</tr>
<tr class="even">
<td><code>year</code></td>
<td>integer</td>
<td></td>
</tr>
<tr class="odd">
<td><code>age</code></td>
<td>integer</td>
<td>non-negative</td>
</tr>
<tr class="even">
<td><code>cohort</code></td>
<td>integer</td>
<td>
<code>year</code> - <code>age</code>
</td>
</tr>
<tr class="odd">
<td><code>immunity</code></td>
<td>numeric</td>
<td>[0, 1]</td>
</tr>
<tr class="even">
<td><code>pop_size</code></td>
<td>numeric</td>
<td>non-negative</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="class-attributes">Class attributes<a class="anchor" aria-label="anchor" href="#class-attributes"></a>
</h4>
<p>In addition to the attributes that every dataframe has
(<code>names</code>, <code>class</code>, <code>row.names</code>), the
objects of the <code>popim_population</code> class also retain the input
parameters of the basic constructor <code><a href="../reference/popim_population.html">popim_population()</a></code>:</p>
<ul>
<li>
<code>region</code>: a character vector of all regions in this
object,</li>
<li>
<code>year_min</code> and <code>year_max</code>: the range of years,
and</li>
<li>
<code>age_min</code> and <code>age_max</code>: the age range covered
in this population.</li>
</ul>
</div>
<div class="section level4">
<h4 id="create-modify-and-validate-objects-of-this-class">Create, modify and validate objects of this class<a class="anchor" aria-label="anchor" href="#create-modify-and-validate-objects-of-this-class"></a>
</h4>
<p>create: <code><a href="../reference/popim_population.html">popim_population()</a></code>,
<code><a href="../reference/read_popim_pop.html">read_popim_pop()</a></code>, <code><a href="../reference/as_popim_pop.html">as_popim_pop()</a></code></p>
<p>modify: <code><a href="../reference/apply_vacc.html">apply_vacc()</a></code></p>
<p>validate: <code>is_population()</code> <em>(currently not
exported)</em></p>
</div>
</div>
<div class="section level3">
<h3 id="s3-class-popim_vacc_activities">S3 class <code>popim_vacc_activities</code><a class="anchor" aria-label="anchor" href="#s3-class-popim_vacc_activities"></a>
</h3>
<p>The class <code>popim_vacc_activities</code> is designed to hold
information on vaccination activities that have occurred or are planned
in the population of interest. Each row of the dataframe relates to one
vaccination activity.</p>
<div class="section level4">
<h4 id="the-dataframe-1">The dataframe<a class="anchor" aria-label="anchor" href="#the-dataframe-1"></a>
</h4>
<p>The mandatory columns are:</p>
<ul>
<li>
<code>region</code>: The region in which the vaccination activity
takes place. While this is a free character field, when applied to a
population, this must match a region that occurs in the population.</li>
<li>
<code>year</code>: year during which the vaccination activity takes
place.</li>
<li>
<code>age_first</code>: youngest age group to be targeted.</li>
<li>
<code>age_last</code>: oldest age group to be targeted.</li>
<li>
<code>coverage</code>: proportion of the target population to be
immunised.</li>
<li>
<code>doses</code>: number of doses used in the vaccination
activity.</li>
<li>
<code>targeting</code>: determines how doses are allocated when
there is pre-existing immunity in the population, see <a href="#vaccinating-a-cohort-with-previous-immunity">below</a> for a
description of the different <code>targeting</code> methods.</li>
</ul>
<table class="table">
<thead><tr class="header">
<th>column</th>
<th>type</th>
<th>range</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>region</code></td>
<td>character</td>
<td></td>
</tr>
<tr class="even">
<td><code>year</code></td>
<td>integer</td>
<td></td>
</tr>
<tr class="odd">
<td><code>age_first</code></td>
<td>integer</td>
<td>non-negative</td>
</tr>
<tr class="even">
<td><code>age_last</code></td>
<td>integer</td>
<td>
<span class="math inline">\(\ge\)</span> <code>age_first</code>
</td>
</tr>
<tr class="odd">
<td><code>coverage</code></td>
<td>numeric</td>
<td>[0, 1]</td>
</tr>
<tr class="even">
<td><code>doses</code></td>
<td>numeric</td>
<td>non-negative</td>
</tr>
<tr class="odd">
<td><code>targeting</code></td>
<td>character</td>
<td>
<code>"random"</code>, <code>"correlated"</code>,
<code>"targeted"</code>
</td>
</tr>
</tbody>
</table>
<div class="section level5">
<h5 id="relationship-between-coverage-doses-and-target-population">Relationship between coverage, doses and target population<a class="anchor" aria-label="anchor" href="#relationship-between-coverage-doses-and-target-population"></a>
</h5>
<p>If the target population size is known, the information on coverage
and doses is redundant (and potentially conflicting) as coverage = doses
/ target population size. However, the
<code>popim_vacc_activities</code> object does not store information on
population size, this is held in the <code>popim_population</code>
object to which the vaccination activities will be applied, so this
potential conflict cannot be detected in a
<code>popim_vacc_activities</code> object in isolation. The validator
for this class, <code>validate_vacc_activities()</code>, checks that the
required columns exist and are of correct data type and range (where
applicatble). It also currently requires that at least one of
<code>coverage</code> and <code>doses</code> is non-missing in each
column. <em>(This behaviour is maybe not sensible as inconsistent with
the other columns?)</em></p>
</div>
</div>
<div class="section level4">
<h4 id="class-attributes-1">Class attributes<a class="anchor" aria-label="anchor" href="#class-attributes-1"></a>
</h4>
<p>As this is a subclass of dataframe, it has the same attributes as a
dataframe (<code>names</code>, <code>class</code> and
<code>row_names</code>). It has no additional attributes.</p>
</div>
<div class="section level4">
<h4 id="create-and-validate-objects-of-this-class">Create and validate objects of this class<a class="anchor" aria-label="anchor" href="#create-and-validate-objects-of-this-class"></a>
</h4>
<p>create: <code><a href="../reference/popim_vacc_activities.html">popim_vacc_activities()</a></code>,
<code><a href="../reference/read_vacc_activities.html">read_vacc_activities()</a></code>, <code><a href="../reference/as_vacc_activities.html">as_vacc_activities()</a></code>,
<code><a href="../reference/vacc_from_immunity.html">vacc_from_immunity()</a></code></p>
<p>modify: <code><a href="../reference/complete_vacc_activities.html">complete_vacc_activities()</a></code></p>
<p>validate: <code>validate_vacc_activities()</code> <em>(currently not
exported)</em></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="primary-functionality-applying-vaccination-activities-to-a-population">Primary functionality: applying vaccination activities to a
population<a class="anchor" aria-label="anchor" href="#primary-functionality-applying-vaccination-activities-to-a-population"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">child_env</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">new.env</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">child_env</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"vignette"</span></span>
<span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit_child.html" class="external-link">knit_child</a></span><span class="op">(</span><span class="st">"../man/rmd/apply.Rmd"</span>, envir <span class="op">=</span> <span class="va">child_env</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">res</span>, sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<p>Once objects holding data on the population and vaccination
activities have been set up, the primary functionality provided by
<code>popim</code> is to apply the vaccination activities to the
population to evaluate the population immunity by age over time that
results from the given vaccination activities, which is done with the
function <code><a href="../reference/apply_vacc.html">apply_vacc()</a></code>.</p>
<div class="section level3">
<h3 id="assumptions-when-applying-vaccination-activities-to-the-population">Assumptions when applying vaccination activities to the
population<a class="anchor" aria-label="anchor" href="#assumptions-when-applying-vaccination-activities-to-the-population"></a>
</h3>
<ul>
<li>100% vaccine effectiveness</li>
<li>no wastage of doses</li>
<li>no waning immunity</li>
<li>mortality is independent of immunity status</li>
</ul>
<p>While the first two are clearly unrealistic assumptions, if there is
a constant vaccine effectiveness (&lt;100%), or a constant wastage
factor, the results can easily be scaled up by these constant factors to
obtain more realistic values for vaccine demand.</p>
<p>For a potentially deadly disease one would expect that mortality due
to the disease would be strongly correlated with immunity status,
however, even the most devastating outbreaks typically only affect a
small part of the population, and therefore all-cause mortality will be
much less impacted by mortality due to the specific disease. This means
that this assumption is closer to reality than it might appear at
first.</p>
<p>Waning immunity is a potentially important factor to consider for
many vaccines, particularly when looking at the long term benefits of
vaccination. However, allowing for this is currently not
implemented.</p>
</div>
<div class="section level3">
<h3 id="description-of-the-algorithm">Description of the algorithm<a class="anchor" aria-label="anchor" href="#description-of-the-algorithm"></a>
</h3>
<p>The vaccination activities object has columns for
<code>coverage</code>, the proportion of the target population that will
be vaccinated, and <code>doses</code>, the number of vaccine doses to be
administered in the activity. Given a target population size this is
redundant (and potentially conflicting) information. The function
<code><a href="../reference/apply_vacc.html">apply_vacc()</a></code> will always use <code>coverage</code>
information in preference over <code>doses</code>, if this is
non-missing. If <code>coverage</code> is missing, the target population
size (based on the population size of the region and age groups
targeted) will be calculated and the corresponding <code>coverage</code>
calculated as <code>doses</code> / <code>target_population</code>.</p>
<div class="section level4">
<h4 id="vaccinating-a-cohort-with-no-previous-immunity">Vaccinating a cohort with no previous immunity<a class="anchor" aria-label="anchor" href="#vaccinating-a-cohort-with-no-previous-immunity"></a>
</h4>
<p>When vaccination is applied to a particular birth cohort that has no
immunity, the result is simply that the proportion of the cohort
receiving the vaccine will be immune from the time of the vaccination
onwards, i.e., the immunity for this cohort will be set to equal the
coverage of the vaccination activity in question. Due to the annual time
step, vaccination is assumed to take effect at the end of the year in
which it is implemented, so the immunity is updated from the next year
onwards.</p>
</div>
<div class="section level4">
<h4 id="vaccinating-a-cohort-with-previous-immunity">Vaccinating a cohort with previous immunity<a class="anchor" aria-label="anchor" href="#vaccinating-a-cohort-with-previous-immunity"></a>
</h4>
<p>When a vaccination activity is applied to a cohort that has some
previous immunity, we need to make some assumptions about who will be
vaccinated in the new activity. There are 3 different options
implemented which are governed by the parameter <code>targeting</code>,
one of the input parameters to the function <code><a href="../reference/apply_vacc.html">apply_vacc()</a></code>.
This parameter can take the values <code>"targeted"</code>,
<code>"random"</code> or <code>"correlated"</code>.</p>
<div class="section level5">
<h5 id="targeted-targeting">
<code>"targeted"</code> targeting<a class="anchor" aria-label="anchor" href="#targeted-targeting"></a>
</h5>
<p>The most effective way to implement a new vaccination activity is to
use <code>"targeted"</code> targeting, meaning that the vaccine is
targeted at previously non-immunised individuals. This means that the
new immunity of after the vaccination activity is simply the sum of the
previous immunity and the coverage of the current vaccination activity
(capped by 1 which indicates complete immunity of the cohort in
question):</p>
<p><span class="math display">\[\rm{immunity}_{\rm new} =
\min(\rm{immunity}_{\rm prev} + \rm{coverage}, 1)\]</span></p>
<p>While this is not a realistic assumption in many settings, it can be
useful for instance in multi-year campaigns that target the same region
(but possibly proceed sub-region by sub-region) over several years. This
multi-year campaign would be coded as separate vaccination activities
for each year, using the option <code>targeting</code> =
<code>"targeted"</code>.</p>
</div>
<div class="section level5">
<h5 id="random-targeting">
<code>"random"</code> targeting<a class="anchor" aria-label="anchor" href="#random-targeting"></a>
</h5>
<p>A reasonable first assumption might be to use <code>targeting</code>
= <code>"random"</code>, meaning that individuals will receive
vaccination irrespective of their previous immunity status. The immunity
after the new campaign is applied is calculated according to</p>
<p><span class="math display">\[
\rm{immunity}_{\rm new} =
\rm{coverage} + \rm{immunity}_{\rm prev} -
\rm{coverage}*\rm{immunity}_{\rm prev}\]</span></p>
</div>
<div class="section level5">
<h5 id="correlated-targeting">
<code>"correlated"</code> targeting<a class="anchor" aria-label="anchor" href="#correlated-targeting"></a>
</h5>
<p>On the opposite end of the spectrum is the most pessimistic
assumption that might apply in situations where there is unequal access
to vaccination: under <code>"correlated"</code> targeting, people who
have previously been immunised get vaccinated first in the new
vaccination activity, and those previously not immune will only receive
any vaccine if the new coverage extends further:</p>
<p><span class="math display">\[
\rm{immunity}_{\rm new} =
\max(\rm{immunity}_{\rm prev}, \rm{coverage})\]</span></p>
<p>Note that the order in which vaccination activities are applied to a
population does not matter under any of the <code>targeting</code>
assumptions.</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="the-inverse">The inverse<a class="anchor" aria-label="anchor" href="#the-inverse"></a>
</h3>
<p><code><a href="../reference/vacc_from_immunity.html">vacc_from_immunity()</a></code></p>
</div>
</div>
<div class="section level2">
<h2 id="summary-visualisation">Summary &amp; Visualisation<a class="anchor" aria-label="anchor" href="#summary-visualisation"></a>
</h2>
<p><code><a href="../reference/calc_pop_immunity.html">calc_pop_immunity()</a></code></p>
<p><code><a href="../reference/plotting.html">plot_pop_size()</a></code>, <code><a href="../reference/plotting.html">plot_immunity()</a></code></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Tini Garske.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
